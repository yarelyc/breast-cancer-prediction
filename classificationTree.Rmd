---
title: "Predicting Breast Cancer using Decision Trees"
author: "Hugo Argueta"
date: "May 9, 2017"
output: html_document
---

```{r global_options, include=FALSE}
knitr::opts_chunk$set(prompt=TRUE, comment="", echo=TRUE)
```

```{r}
library(rpart)
library(rpart.plot)
```

### Load data

```{r}
set.seed(135)

dat = read.csv("/Users/juice/Documents/CST463/final-project/breast-cancer-prediction/data.csv")
dat$X = NULL
```

### Data exploration

Plot texture_worst by radius_worst

```{r}
plot(dat$texture_worst, dat$radius_worst, col = "green", main = "Texture Worst by Radius Worst", xlab = "texture worst", ylab = "radius worst", pch=16)
malignant = dat$diagnosis == "M"
points(dat[malignant, ]$texture_worst, dat[malignant, ]$radius_worst, col = "red", pch=16)
```

Plot texture_worst by concave.points_worst

```{r}
plot(dat$texture_worst, dat$concave.points_worst, col = "green", main = "Texture Worst by Concave.Points Worst", xlab = "texture worst", ylab = "concave.points worst", pch=16)
malignant = dat$diagnosis == "M"
points(dat[malignant, ]$texture_worst, dat[malignant, ]$concave.points_worst, col = "red", pch=16)
```

```{r}
plot(dat$radius_worst, dat$concave.points_worst, col = "green", main = "Radius Worst by Concave.Points Worst", xlab = "radius worst", ylab = "concave.points worst", pch=16)
malignant = dat$diagnosis == "M"
points(dat[malignant, ]$radius_worst, dat[malignant, ]$concave.points_worst, col = "red", pch=16)
```

### Split dataset into training set and testing set

```{r}
num_tr = sample(1:nrow(dat), floor(nrow(dat) * .75))
tr_dat = dat[num_tr,]
te_dat = dat[-num_tr,]
```

### Create Decision Tree classifier (Model 1)

```{r}
fit = rpart(diagnosis ~ radius_mean + concave.points_mean + texture_mean, data=tr_dat, method="class")

prp(fit, extra=106, varlen=-10, main="Classification Tree for Breast Cancer (Model 1)", box.col=c("green","red")[fit$frame$yval])
```

Confusion matrix for actuals vs. predicted

```{r}
predicts = predict(fit, te_dat, type="class")
actuals = te_dat$diagnosis

conf_mtx = table(actuals, predicts)
conf_mtx
```

We calculate the classifier's accuracy

```{r}
round(mean(predicts == actuals), 3)
```

Here, we calculate the classifier's precision

```{r}
conf_mtx[2,2] / (conf_mtx[2,2] + conf_mtx[1,2])
```

Here, we calculate the classifier's recall

```{r}
conf_mtx[2,2] / (conf_mtx[2,2] + conf_mtx[2,1])
```

### Learning Curve for Model 1

```{r}
te_errs = c()
tr_errs = c()
te_actual = te_dat$diagnosis
tr_sizes = seq(100, nrow(tr_dat), length.out=10)
for (tr_size in tr_sizes) {
  tr_dat1 = tr_dat[1:tr_size,]
  tr_actual = tr_dat1$diagnosis
  fit = rpart(diagnosis ~ radius_worst + concave.points_worst + texture_worst, data=tr_dat1, method="class")
  # error on training set
  tr_predicted = predict(fit, tr_dat1, type="class")
  tr_predicted
  err = sum(tr_actual != tr_predicted)/length(tr_predicted)
  tr_errs = c(tr_errs, err)
 
  # error on test set
  te_predicted = predict(fit, te_dat, type="class")
  err = sum(te_actual != te_predicted)/length(te_predicted)
  te_errs = c(te_errs, err)
  te_errs
}

plot(range(tr_sizes), range(te_errs, tr_errs), type='n', xlab='training set size', ylab='error')

lines(tr_sizes, tr_errs, col='red')
lines(tr_sizes, te_errs, col='blue')
```

### Create Decision Tree classifier (Model 2)

```{r}
fit2 = rpart(diagnosis ~ radius_worst + concave.points_worst + texture_worst, data=tr_dat, method="class")

prp(fit2, extra=106, varlen=-10, main="Classification Tree for Breast Cancer (Model 2)", box.col=c("green", "red")[fit2$frame$yval])
```

Confusion matrix for actuals vs. predicted

```{r}
predicts2 = predict(fit2, te_dat, type="class")
actuals2 = te_dat$diagnosis

conf_mtx2 = table(actuals2, predicts2)
conf_mtx2
```

We calculate the classifier's accuracy

```{r}
round(mean(predicts2 == actuals2), 3)
```



Here, we calculate the classifier's precision

```{r}
conf_mtx2[2,2] / (conf_mtx2[2,2] + conf_mtx2[1,2])
```

Here, we calculate the classifier's recall

```{r}
conf_mtx2[2,2] / (conf_mtx2[2,2] + conf_mtx2[2,1])
```

### Learning Curve for Decision Tree Classification (Model 2)

```{r}
te_errs = c()
tr_errs = c()
te_actual = te_dat$diagnosis
tr_sizes = seq(100, nrow(tr_dat), length.out=10)
for (tr_size in tr_sizes) {
  tr_dat1 = tr_dat[1:tr_size,]
  tr_actual = tr_dat1$diagnosis
  fit = rpart(diagnosis ~ radius_worst + concave.points_worst + texture_worst, data=tr_dat1, method="class")
  # error on training set
  tr_predicted = predict(fit, tr_dat1, type="class")
  tr_predicted
  err = sum(tr_actual != tr_predicted)/length(tr_predicted)
  tr_errs = c(tr_errs, err)
 
  # error on test set
  te_predicted = predict(fit, te_dat, type="class")
  err = sum(te_actual != te_predicted)/length(te_predicted)
  te_errs = c(te_errs, err)
  te_errs
}

plot(range(tr_sizes), range(te_errs, tr_errs), type='n', xlab='training set size', ylab='error')

lines(tr_sizes, tr_errs, col='red')
lines(tr_sizes, te_errs, col='blue')
```